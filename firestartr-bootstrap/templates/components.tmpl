{{ range $index, $claim := .Components }}
{{- if not $claim.Skipped }}
---
kind: ComponentClaim
version: "1.0"
type: service
lifecycle: production
{{- if $.DefaultSystemName }}
system: system:{{ $.DefaultSystemName }}
{{- else }}
system: system:{{ $.Org }}-system
{{- end }}
name: {{ $claim.Name }}
providers:
  github:
    description: {{ $claim.Description }}
    name: {{ default $claim.Name $claim.RepoName }}
    org: {{ $.Org }}
    visibility: private
    branchStrategy:
      name: none
      defaultBranch: {{ $claim.DefaultBranch }}
    actions:
      oidc:
        useDefault: false
        includeClaimKeys:
          - repo
    features:
      {{- range $index, $feature := $claim.Features }}
      - name: {{ $feature.Name }}
        version: {{ $feature.Version }}
      {{- end }}
{{ end }}
{{ end }}
---
kind: SystemClaim
version: "1.0"
{{- if $.DefaultSystemName }}
name: {{ $.DefaultSystemName }}
{{- else }}
name: {{ $.Org }}-system
{{- end }}
{{- if $.DefaultDomainName }}
domain: domain:{{ $.DefaultDomainName }}
{{- else }}
domain: domain:{{ $.Org }}-domain
{{- end }}
{{- if $.DefaultGroupName }}
owner: group:{{ $.DefaultGroupName }}
{{- else }}
owner: group:{{ $.Org }}-all
{{- end }}
description: "The default system of {{ $.Org }}"
---
kind: DomainClaim
version: "1.0"
{{- if $.DefaultDomainName }}
name: {{ $.DefaultDomainName }}
{{- else }}
name: {{ $.Org }}-domain
{{- end }}
description: "The default domain of {{ $.Org }}"
{{- if $.DefaultGroupName }}
owner: group:{{ $.DefaultGroupName }}
{{- else }}
owner: group:{{ $.Org }}-all
{{- end }}
